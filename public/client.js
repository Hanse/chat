// Generated by CoffeeScript 1.3.3
(function() {
  var makeSafe, scroll, socket;

  socket = io.connect();

  makeSafe = function(str) {
    return str.replace(/\W/g, function(chr) {
      return "&#" + (chr.charCodeAt(0)) + ";";
    });
  };

  scroll = function(elem) {
    return $(elem).each(function() {
      var scrollHeight;
      scrollHeight = Math.max(this.scrollHeight, this.clientHeight);
      return this.scrollTop = scrollHeight - this.clientHeight;
    });
  };

  socket.on("connect", function() {
    socket.emit("join", prompt("Name:") || "Anonymous");
    return $("#data").focus();
  });

  socket.on("update_chat", function(user, data) {
    $("<p></p>").html("<strong>" + user.name + ":</strong> " + (makeSafe(data))).appendTo("#room");
    return scroll("#room");
  });

  socket.on("update_users", function(users) {
    $("#users ul").empty();
    return $.each(users, function(key, value) {
      return $("#users ul").append("<li>" + key + "</li>");
    });
  });

  $("#data").keypress(function(event) {
    if (event.keyCode === 13) {
      socket.emit("send", $("#data").val());
      return $("#data").val("");
    }
  });

}).call(this);
